<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.39 in css mode. -->
<html>
  <head>
    <title>pdf.org</title>
    <style type="text/css">
    <!--
      body {
        color: #dcdccc;
        background-color: #3f3f3f;
      }
      .hl-line {
        /* hl-line */
        background-color: #4d4d4d;
      }
      .org-block {
        /* org-block */
        color: #b3b3b3;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #7f9f7f;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #7f9f7f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #b3b3b3;
      }
      .org-document-title {
        /* org-document-title */
        color: #afeeee;
        font-weight: bold;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #dfaf8f;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #8fb28f;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #7cb8bb;
      }
      .org-link {
        /* org-link */
        color: #d0bf8f;
        text-decoration: underline;
      }
      .org-target {
        /* org-target */
        text-decoration: underline;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b3b3b3;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-document-info-keyword">#+title:</span> <span class="org-document-title">PDF file format
</span>
In order to make a blank PDF file page, we'll have to deal with two
structures:
1. File structure
2. Document Structure
File structure defines all the data needed to parse a file as PDF
format, while the document structure defines the content of the file body.

<span class="org-level-1">* PDF file structure</span>

<span class="org-level-2">** Overview of file structure</span>

A PDF contains 4 sections:
1. Header, defines the version of PDF specification
2. Body, the actual content that will be displayed.
3. Cross-reference table, a table for PDF viewers to quickly access
   different objects.
4. Trailer, defines other meta info of a PDF file.

Here is an image showing the file structure of PDF file:
<span class="org-link">[[file:images/2015-08-15-pdf-file-structure.png][PDF file structure]]</span>

<span class="org-level-2">** Explaination of Sample PDF file</span>

So now I'll show a working example: <span class="org-link">[[file:files/2015-08-15-mypdf.pdf]]</span>.
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">%PDF-1.7
1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj

2 0 obj
  &lt;&lt; /Type /Pages
     /Kids [3 0 R]
     /Count 1
  &gt;&gt;
endobj

3 0 obj
  &lt;&lt; /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 600 400]
     /Resources &lt;&lt; &gt;&gt;
  &gt;&gt;
endobj

xref
0 4
00000000000 65535 f
00000000010 00000 n
00000000069 00000 n
00000000141 00000 n
trailer
  &lt;&lt; /Root 1 0 R
     /Size 4
  &gt;&gt;
startxref
249
%%EOF
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-level-3">*** Object Syntax</span>

<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj
</span><span class="org-block-end-line">#+end_example
</span>The above is one object.
1. Its name is <span class="org-verbatim">=1=</span>, <span class="org-verbatim">=0=</span> is its version number, normally they are not
   used.
2. <span class="org-verbatim">=obj=</span> and <span class="org-verbatim">=endobj=</span> delimit the beginning and end of an object.
3. <span class="org-verbatim">=</span><span class="org-target"><span class="org-verbatim">&lt;&lt; &gt;&gt;</span></span><span class="org-verbatim">=</span> defines an dictionary object.

You can refer to the
<span class="org-link">[[http://www.adobe.com/devnet/pdf/pdf_reference.html][Adobe PDF
references]]</span> for details of the synatx.

Note that althrough the object names in the example are <span class="org-verbatim">=1, 2, 3,
...=</span>, you can choose any name(in number perhaps?).

<span class="org-level-3">*** Header</span>
The line <span class="org-verbatim">=%PDF-1.7=</span> is the header and defines that this file uses PDF
1.7 specification.

<span class="org-level-3">*** Body</span>

The contents below the header and above the line <span class="org-verbatim">=xref=</span> are the
body. In order to correctly show up a PDF, the body should have the
structure defined by Document Structure, which we will talk later.

<span class="org-level-3">*** Cross-Reference Table</span>
Well, this part is the hardest part to understand. If uncorrectly set,
the PDF viewer will give out errors.

The cross-reference table are used for quick accessing every objects
appear in the body. So we need to give every object an cross-reference entry.

<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">xref
0 4
00000000000 65535 f
00000000010 00000 n
00000000069 00000 n
00000000141 00000 n
</span><span class="org-block-end-line">#+end_example
</span>
This Cross-Reference table begins with the keyword <span class="org-verbatim">=xref=</span> and an <span class="org-verbatim">=EOL=</span>.

Then comes a line to indicate the starting object: <span class="org-verbatim">=0=</span> in our
case, and we have <span class="org-verbatim">=4=</span> sequential entries corresponds to <span class="org-verbatim">=4=</span> objects in
the body.

But we only have objects <span class="org-verbatim">=1, 2, 3=</span> in the body, how is that? The 0th
object is the root of the body(which is different to the <span class="org-verbatim">=Document
Catalog=</span>) and will not show.

Next comes several entries, each entry comes in the format of
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">nnnnnnnnnn ggggg n eol
</span><span class="org-block-end-line">#+end_example
</span>where
1. <span class="org-verbatim">=nnnnnnnnnn=</span> is a 10-digit byte offset of the object starting from
   the beginning of the document.
2. <span class="org-verbatim">=ggggg=</span> is a 5-digit generation number, to indicate which
   generation current object is. Each time the object is deleted and
   then reused, it is given a new generation number.
3. entry type, <span class="org-verbatim">=n=</span> for in-use, <span class="org-verbatim">=f=</span> for <span class="org-verbatim">=free=</span> (not used).
4. <span class="org-verbatim">=&lt;space&gt;&lt;linefeed&gt;=</span> in case of Unix EOL format, <span class="org-verbatim">=&lt;carriage
   return&gt;&lt;linefeed&gt;=</span> in case of Windows EOL format.
In total the entry takes up exactly 20 bytes.

So in our case, the entry
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">00000000069 00000 n
</span><span class="org-block-end-line">#+end_example
</span>is the third entry, since it starts from object 0, so it refers to object:
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">2 0 obj
  &lt;&lt; /Type /Pages
     /Kids [3 0 R]
     /Count 1
  &gt;&gt;
endobj
</span><span class="org-block-end-line">#+end_example
</span>
And the offset of the this object is <span class="org-verbatim">=69=</span>, and we don't use any
generation related feature(<span class="org-verbatim">=00000=</span>), and this entry is in used(<span class="org-verbatim">=n=</span>).

<span class="org-level-3">*** Trailer</span>
Trailer section gives us the overrall information of the PDF
documents, it must contains a dictionary, which should have at least
two entries: <span class="org-verbatim">=/Root=</span> and <span class="org-verbatim">=/Size=</span>.
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">trailer
  &lt;&lt; /Root 1 0 R
     /Size 4
  &gt;&gt;
startxref
249
%%EOF
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-verbatim">=/Root=</span> refers to the <span class="org-verbatim">=Catalog=</span> of the body(Next section). <span class="org-verbatim">=/Size=</span>
refers to the total number of entries in the file's cross-reference table.

<span class="org-verbatim">=startxref=</span> follows by a line of a number, indicates the start offset
of the cross-reference table. i.e. the offset of the keyword <span class="org-verbatim">=xref=</span>.

<span class="org-verbatim">=%%EOF=</span> indicates the end of the file.

The main purpose of the trailer section is that the viewer can read
the file from bottom, and:
1. find out the offset of the cross-reference table by <span class="org-verbatim">=startxref=</span> part.
2. find out the root object by the <span class="org-verbatim">=/Root=</span> entry in <span class="org-verbatim">=trailer=</span> part.

Then the viewer will be able to find the real content of root
object(<span class="org-verbatim">=1 0 R=</span> in our example) in offset <span class="org-verbatim">=0000000010=</span> with the help of
cross-reference table. The root contains object (<span class="org-verbatim">=2 0 R=</span>) as written
in <span class="org-verbatim">=/Pages 2 0 R=</span>. So the PDF viewer will find goto offset
<span class="org-verbatim">=0000000069=</span> with the help of cross-reference table. And so on until
the whole PDF object tree are parsed.

<span class="org-level-1">* Document Structure</span>

A PDF document is orgnized in a tree hierarchy. The root of the
tree is called <span class="org-verbatim">=Document Catalog=</span> and is specified by the <span class="org-verbatim">=/Root=</span>
entry in <span class="org-verbatim">=trailer=</span>.

<span class="org-link">[[file:image/2015-08-15-pdf-document-structure.png][Document Structure]]</span>

Here I'll cover only the simpliest case to help us create a blank PDF document.

<span class="org-level-2">** Document Catalog</span>
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj
</span><span class="org-block-end-line">#+end_example
</span>1. [Must] specify the <span class="org-verbatim">=/Type=</span> to <span class="org-verbatim">=/Catalog=</span>.
2. [Must] specify the <span class="org-verbatim">=/Pages=</span> entry.

<span class="org-level-2">** Pages</span>
<span class="org-verbatim">=Pages=</span> node is the root node of a page tree. Below is an exmple of
page tree hierarchy.
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">  2 0 obj
    &lt;&lt; /Type /Pages
       /Kids [ 4 0 R
               10 0 R
               24 0 R]
       /Count 3
    &gt;&gt;
  endobj

  4 0 obj
    &lt;&lt; /Type /Page
    ... Additional entries describing the attributes of this page ...
    &gt;&gt;
  endobj

  10 0 obj
    &lt;&lt; /Type /Page
       ... Additional entries describing the attributes of this page ...
    &gt;&gt;
  endobj

  24 0 obj
    &lt;&lt; /Type /Page
       ... Additional entries describing the attributes of this page ...
    &gt;&gt;
  endobj
</span><span class="org-block-end-line">#+end_example
</span>1. <span class="org-verbatim">=/Type=</span> must be set to <span class="org-verbatim">=/Pages=</span>
2. <span class="org-verbatim">=/Parent=</span> should be set except in root node.
3. <span class="org-verbatim">=/Kids=</span> array should be sed to specify the child pages.
4. <span class="org-verbatim">=/Count=</span> must be set to specify the number of leaf nodes(page objects).

<span class="org-level-2">** Page Object</span>
<span class="org-block-begin-line">#+begin_example
</span><span class="org-block">3 0 obj
  &lt;&lt; /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 600 400]
     /Resources &lt;&lt; &gt;&gt;
  &gt;&gt;
endobj
</span><span class="org-block-end-line">#+end_example
</span>1. <span class="org-verbatim">=/Type=</span> should be set to <span class="org-verbatim">=/Page=</span>
2. <span class="org-verbatim">=/Parent=</span> shoudl be set to its parent object.
3. <span class="org-verbatim">=/MediaBox=</span> is a rectangle on the page to store media contents.
4. <span class="org-verbatim">=/Resources=</span> contains any resources(e.g. fonts) that are required
   by this page.

<span class="org-level-1">* Summary</span>
This post explains the bootstrap information we need to know about PDF
file format.
1. PDF file structure
2. PDF document structure

Of course with this we are not able to do fancy things yet, I
recommand read the
<span class="org-link">[[http://www.adobe.com/devnet/pdf/pdf_reference.html][Adobe PDF
</span><span class="org-link"><span class="hl-line">specification]]</span></span><span class="hl-line"> after this. So, enjoy.
</span>
<span class="org-level-1">* References</span>
- <span class="org-link">[[https://blog.idrsolutions.com/2010/09/grow-your-own-pdf-file-part-1-pdf-objects-and-data-types/][Make your own PDF file]]</span>
- <span class="org-link">[[http://brendanzagaeski.appspot.com/0005.html][Hand Coded PDF
  tutorial]]</span>
- <span class="org-link">[[http://www.adobe.com/devnet/pdf/pdf_reference.html][Adobe PDF references]]</span>
</pre>
  </body>
</html>
