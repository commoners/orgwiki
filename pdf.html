<!DOCTYPE html>
<html>
<head>
<title>PDF file format</title>
<!-- 2015-08-15 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Wang Menglei">
<link rel="Stylesheet" type="text/css" href="assets/css/style.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript">
    function show_org_source(){
       /* document.location.href = rpl(document.location.href,"html","org.html"); */
       var url = document.location.href.split('#')[0];
       document.location.href = url.replace(/.html$/, '.org.html');
    }
</script>
</head>
<body>
<div id="preamble" class="status">
<!--<body onload="prettyPrint()">-->
<nav>
    <a href="index.html">Index</a>
    <a href="about.html">About</a>
    <a href="https://lotabout.github.io">Blog</a>
    <a href="sitemap.html">SiteMap</a>
</nav>
</div>
<div id="content">
<h1 class="title">PDF file format</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">PDF file structure</a>
<ul>
<li><a href="#sec-1-1">Overview of file structure</a></li>
<li><a href="#sec-1-2">Explaination of Sample PDF file</a>
<ul>
<li><a href="#sec-1-2-1">Object Syntax</a></li>
<li><a href="#sec-1-2-2">Header</a></li>
<li><a href="#sec-1-2-3">Body</a></li>
<li><a href="#sec-1-2-4">Cross-Reference Table</a></li>
<li><a href="#sec-1-2-5">Trailer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">Document Structure</a>
<ul>
<li><a href="#sec-2-1">Document Catalog</a></li>
<li><a href="#sec-2-2">Pages</a></li>
<li><a href="#sec-2-3">Page Object</a></li>
</ul>
</li>
<li><a href="#sec-3">Summary</a></li>
<li><a href="#sec-4">References</a></li>
</ul>
</div>
</div>
<p>
In order to make a blank PDF file page, we'll have to deal with two
structures:
</p>
<ol class="org-ol">
<li>File structure
</li>
<li>Document Structure
</li>
</ol>
<p>
File structure defines all the data needed to parse a file as PDF
format, while the document structure defines the content of the file body.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">PDF file structure</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Overview of file structure</h3>
<div class="outline-text-3" id="text-1-1">
<p>
A PDF contains 4 sections:
</p>
<ol class="org-ol">
<li>Header, defines the version of PDF specification
</li>
<li>Body, the actual content that will be displayed.
</li>
<li>Cross-reference table, a table for PDF viewers to quickly access
different objects.
</li>
<li>Trailer, defines other meta info of a PDF file.
</li>
</ol>

<p>
Here is an image showing the file structure of PDF file:
<a href="images/2015-08-15-pdf-file-structure.png">PDF file structure</a>
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Explaination of Sample PDF file</h3>
<div class="outline-text-3" id="text-1-2">
<p>
So now I'll show a working example: <a href="files/2015-08-15-mypdf.pdf">files/2015-08-15-mypdf.pdf</a>.
</p>
<pre class="example">
%PDF-1.7
1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj

2 0 obj
  &lt;&lt; /Type /Pages
     /Kids [3 0 R]
     /Count 1
  &gt;&gt;
endobj

3 0 obj
  &lt;&lt; /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 600 400]
     /Resources &lt;&lt; &gt;&gt;
  &gt;&gt;
endobj

xref
0 4
00000000000 65535 f
00000000010 00000 n
00000000069 00000 n
00000000141 00000 n
trailer
  &lt;&lt; /Root 1 0 R
     /Size 4
  &gt;&gt;
startxref
249
%%EOF
</pre>
</div>

<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">Object Syntax</h4>
<div class="outline-text-4" id="text-1-2-1">
<pre class="example">
1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj
</pre>
<p>
The above is one object.
</p>
<ol class="org-ol">
<li>Its name is <code>1</code>, <code>0</code> is its version number, normally they are not
used.
</li>
<li><code>obj</code> and <code>endobj</code> delimit the beginning and end of an object.
</li>
<li><code>&lt;&lt; &gt;&gt;</code> defines an dictionary object.
</li>
</ol>

<p>
You can refer to the
<a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">Adobe PDF
references</a> for details of the synatx.
</p>

<p>
Note that althrough the object names in the example are <code>1, 2, 3,
...</code>, you can choose any name(in number perhaps?).
</p>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Header</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
The line <code>%PDF-1.7</code> is the header and defines that this file uses PDF
1.7 specification.
</p>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">Body</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
The contents below the header and above the line <code>xref</code> are the
body. In order to correctly show up a PDF, the body should have the
structure defined by Document Structure, which we will talk later.
</p>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">Cross-Reference Table</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
Well, this part is the hardest part to understand. If uncorrectly set,
the PDF viewer will give out errors.
</p>

<p>
The cross-reference table are used for quick accessing every objects
appear in the body. So we need to give every object an cross-reference entry.
</p>

<pre class="example">
xref
0 4
00000000000 65535 f
00000000010 00000 n
00000000069 00000 n
00000000141 00000 n
</pre>

<p>
This Cross-Reference table begins with the keyword <code>xref</code> and an <code>EOL</code>.
</p>

<p>
Then comes a line to indicate the starting object: <code>0</code> in our
case, and we have <code>4</code> sequential entries corresponds to <code>4</code> objects in
the body.
</p>

<p>
But we only have objects <code>1, 2, 3</code> in the body, how is that? The 0th
object is the root of the body(which is different to the <code>Document
Catalog</code>) and will not show.
</p>

<p>
Next comes several entries, each entry comes in the format of
</p>
<pre class="example">
nnnnnnnnnn ggggg n eol
</pre>
<p>
where
</p>
<ol class="org-ol">
<li><code>nnnnnnnnnn</code> is a 10-digit byte offset of the object starting from
the beginning of the document.
</li>
<li><code>ggggg</code> is a 5-digit generation number, to indicate which
generation current object is. Each time the object is deleted and
then reused, it is given a new generation number.
</li>
<li>entry type, <code>n</code> for in-use, <code>f</code> for <code>free</code> (not used).
</li>
<li><code>&lt;space&gt;&lt;linefeed&gt;</code> in case of Unix EOL format, <code>&lt;carriage
   return&gt;&lt;linefeed&gt;</code> in case of Windows EOL format.
</li>
</ol>
<p>
In total the entry takes up exactly 20 bytes.
</p>

<p>
So in our case, the entry
</p>
<pre class="example">
00000000069 00000 n
</pre>
<p>
is the third entry, since it starts from object 0, so it refers to object:
</p>
<pre class="example">
2 0 obj
  &lt;&lt; /Type /Pages
     /Kids [3 0 R]
     /Count 1
  &gt;&gt;
endobj
</pre>

<p>
And the offset of the this object is <code>69</code>, and we don't use any
generation related feature(<code>00000</code>), and this entry is in used(<code>n</code>).
</p>
</div>
</div>

<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5">Trailer</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
Trailer section gives us the overrall information of the PDF
documents, it must contains a dictionary, which should have at least
two entries: <code>/Root</code> and <code>/Size</code>.
</p>
<pre class="example">
trailer
  &lt;&lt; /Root 1 0 R
     /Size 4
  &gt;&gt;
startxref
249
%%EOF
</pre>

<p>
<code>/Root</code> refers to the <code>Catalog</code> of the body(Next section). <code>/Size</code>
refers to the total number of entries in the file's cross-reference table.
</p>

<p>
<code>startxref</code> follows by a line of a number, indicates the start offset
of the cross-reference table. i.e. the offset of the keyword <code>xref</code>.
</p>

<p>
<code>%%EOF</code> indicates the end of the file.
</p>

<p>
The main purpose of the trailer section is that the viewer can read
the file from bottom, and:
</p>
<ol class="org-ol">
<li>find out the offset of the cross-reference table by <code>startxref</code> part.
</li>
<li>find out the root object by the <code>/Root</code> entry in <code>trailer</code> part.
</li>
</ol>

<p>
Then the viewer will be able to find the real content of root
object(<code>1 0 R</code> in our example) in offset <code>0000000010</code> with the help of
cross-reference table. The root contains object (<code>2 0 R</code>) as written
in <code>/Pages 2 0 R</code>. So the PDF viewer will find goto offset
<code>0000000069</code> with the help of cross-reference table. And so on until
the whole PDF object tree are parsed.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Document Structure</h2>
<div class="outline-text-2" id="text-2">
<p>
A PDF document is orgnized in a tree hierarchy. The root of the
tree is called <code>Document Catalog</code> and is specified by the <code>/Root</code>
entry in <code>trailer</code>.
</p>

<p>
<a href="image/2015-08-15-pdf-document-structure.png">Document Structure</a>
</p>

<p>
Here I'll cover only the simpliest case to help us create a blank PDF document.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Document Catalog</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
1 0 obj
  &lt;&lt; /Type /Catalog
     /Pages 2 0 R
  &gt;&gt;
endobj
</pre>
<ol class="org-ol">
<li>[Must] specify the <code>/Type</code> to <code>/Catalog</code>.
</li>
<li>[Must] specify the <code>/Pages</code> entry.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Pages</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<code>Pages</code> node is the root node of a page tree. Below is an exmple of
page tree hierarchy.
</p>
<pre class="example">
2 0 obj
  &lt;&lt; /Type /Pages
     /Kids [ 4 0 R
             10 0 R
             24 0 R]
     /Count 3
  &gt;&gt;
endobj

4 0 obj
  &lt;&lt; /Type /Page
  ... Additional entries describing the attributes of this page ...
  &gt;&gt;
endobj

10 0 obj
  &lt;&lt; /Type /Page
     ... Additional entries describing the attributes of this page ...
  &gt;&gt;
endobj

24 0 obj
  &lt;&lt; /Type /Page
     ... Additional entries describing the attributes of this page ...
  &gt;&gt;
endobj
</pre>
<ol class="org-ol">
<li><code>/Type</code> must be set to <code>/Pages</code>
</li>
<li><code>/Parent</code> should be set except in root node.
</li>
<li><code>/Kids</code> array should be sed to specify the child pages.
</li>
<li><code>/Count</code> must be set to specify the number of leaf nodes(page objects).
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Page Object</h3>
<div class="outline-text-3" id="text-2-3">
<pre class="example">
3 0 obj
  &lt;&lt; /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 600 400]
     /Resources &lt;&lt; &gt;&gt;
  &gt;&gt;
endobj
</pre>
<ol class="org-ol">
<li><code>/Type</code> should be set to <code>/Page</code>
</li>
<li><code>/Parent</code> shoudl be set to its parent object.
</li>
<li><code>/MediaBox</code> is a rectangle on the page to store media contents.
</li>
<li><code>/Resources</code> contains any resources(e.g. fonts) that are required
by this page.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Summary</h2>
<div class="outline-text-2" id="text-3">
<p>
This post explains the bootstrap information we need to know about PDF
file format.
</p>
<ol class="org-ol">
<li>PDF file structure
</li>
<li>PDF document structure
</li>
</ol>

<p>
Of course with this we are not able to do fancy things yet, I
recommand read the
<a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">Adobe PDF
specification</a> after this. So, enjoy.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">References</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><a href="https://blog.idrsolutions.com/2010/09/grow-your-own-pdf-file-part-1-pdf-objects-and-data-types/">Make your own PDF file</a>
</li>
<li><a href="http://brendanzagaeski.appspot.com/0005.html">Hand Coded PDF
tutorial</a>
</li>
<li><a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">Adobe PDF references</a>
</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="#" class="back-to-top">Back to Top</a>

<!-- <hr class="comment"> -->
<!-- <div id="show_source"> -->
<!--   <input type="button" value="Show Org source" onClick='show_org_source()'> -->
<!-- </div> -->

</script>
<hr class="comment">
<section class="comment">
<!-- An element a visitor can click if they <3 comments! -->
<button class="btn show-comments">Load Disqus comments</button>
<div id="disqus_thread"></div>
 
<!-- The empty element required for Disqus to loads comments into -->
<!--<div id="disqus_thread"></div>-->
    <!--<script type="text/javascript">-->
        <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
        <!--var disqus_shortname = 'lotaboutvimwiki'; // required: replace example with your forum shortname-->

        <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
        <!--(function() {-->
            <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
            <!--dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';-->
            <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
        <!--})();-->
    <!--</script>-->
    <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
</section>

<footer>
    |采用<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">CC BY-NC-SA 3.0</a>授权|由<a href="http://orgmode.org">Org Mode</a>自动生成<input type="button" value="Show Org source" onClick='show_org_source()'>|部署在<a href="https://github.com/lotabout/orgwiki">Github Pages</a>|
</footer>

    <script src="assets/js/jquery-1.7.1.min.js"></script>
    <script>
$(document).ready(function(){
	var offset = 100;
	var duration = 110;

        $(window).resize(function () {
            var toc= $('#table-of-contents')
            if ($(window).width() <= 800) {
                toc.css('position', 'static')
	        return
            }
            });
        $(window).scroll(
            function () {
            console.log("scroll called.")
            var toc= $('#table-of-contents')
            if ($(window).width() <= 800) {
            toc.css('position', 'static')
            return
            }

            if ($(this).scrollTop() > duration) {
            toc.css('left', toc.position().left + 'px')
            toc.css('position', 'fixed')
            $('.back-to-top').fadeIn(duration);
            } else {
            toc.css('left', '0px')
            toc.css('top', '0px')
            toc.css('position', 'relative')
            $('.back-to-top').fadeOut(duration);
            }
            });
        $('.back-to-top').click(
            function(event) {
            event.preventDefault;
            $('html, body').animate({scrollTop: 0}, duration);
            return false;
            });

        $('.show-comments').on('click', function(){
                               var disqus_shortname = 'lotaboutorgwiki'; // Replace this value with *your* username.

                               // ajax request to load the disqus javascript
                               $.ajax({
type: "GET",
url: "http://" + disqus_shortname + ".disqus.com/embed.js",
dataType: "script",
cache: true
});
                               // hide the button once comments load
                               $(this).fadeOut();
                               });
});
    </script>
</div>
</body>
</html>
