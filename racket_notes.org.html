<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.47 in css mode. -->
<html>
  <head>
    <title>racket_notes.org</title>
    <style type="text/css">
    <!--
      body {
        color: #dcdccc;
        background-color: #3f3f3f;
      }
      .org-block {
        /* org-block */
        color: #b3b3b3;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #7f9f7f;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #7f9f7f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #b3b3b3;
      }
      .org-document-title {
        /* org-document-title */
        color: #afeeee;
        font-weight: bold;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #dfaf8f;
        background-color: #3f3f3f;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #8fb28f;
        background-color: #3f3f3f;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #7cb8bb;
        background-color: #3f3f3f;
      }
      .org-link {
        /* org-link */
        color: #d0bf8f;
        font-weight: bold;
        text-decoration: underline;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b3b3b3;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-document-info-keyword">#+TITLE:</span> <span class="org-document-title">Racket Notes
</span>
<span class="org-level-1">* Installation</span>
  
<span class="org-level-2">** readline support failure</span>
   
   Fail when <span class="org-verbatim">=(require readline)=</span> or <span class="org-verbatim">=(require xrepl)=</span>. With following
   error message.
   
<span class="org-block-begin-line">   #+BEGIN_EXAMPLE
</span><span class="org-block">     ; Warning: no readline support (ffi-lib: couldn't open "libreadline.so.5" (/usr/lib64/libreadline.so.5: undefined symbol: PC)
</span><span class="org-block-end-line">   #+END_EXAMPLE
</span>   
   In slackware, use <span class="org-verbatim">=LD_PRELOAD=/usr/lib64/libcurses.so racket=</span> instead.

<span class="org-level-1">* Racket Guide Notes</span>
<span class="org-level-2">** Classes</span>
<span class="org-level-3">*** Class Declaration</span>
   Use <span class="org-verbatim">=Class=</span> Expression to denote a first-class value:
<span class="org-block-begin-line">#+BEGIN_SRC racket
</span><span class="org-block">  (class superclass-expr decl-or-expr ...)

  ; Example
  (class object%  ; object% is the super class
    (init size)   ; initialization arguments
    (define current-size size) ; note that clause order matters
    (define/public (get-size)  ; public method
      current-size)
    (super-new))  ; superclass initialzation, should always be called.
</span><span class="org-block-end-line">#+END_SRC
</span><span class="org-level-3">*** Public Methods</span>
   Public methods are called by <span class="org-verbatim">=(send instance method arguments ...)=</span>
<span class="org-level-3">*** Initialization arguments</span>
   Initialization arguemnts are specified like the following:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (define default-10-fish%
       (class fish%
         (init [size 10])
         (super-new [size size])))
</span><span class="org-block-end-line">   #+END_SRC
</span><span class="org-level-3">*** Interfaces</span>
   Interfaces are declared by:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (interface (superinterface-expr ...) id ...)
</span><span class="org-block-end-line">   #+END_SRC
</span>   To declare that a class implements an interface, the <span class="org-verbatim">=class*=</span> form
   must be used instead of <span class="org-verbatim">=class=</span>:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (class* superclass-expre (interface-expre ...) decl-or-expr ...)
</span><span class="org-block-end-line">   #+END_SRC
</span>   Example:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (define fish-interface (interface () get-size grow eat))
     (define fish% (class* object% (fish-interface) ...))
</span><span class="org-block-end-line">   #+END_SRC
</span><span class="org-level-3">*** Final, Augment, and Inner</span>
<span class="org-level-1">* Racket Reference</span>
<span class="org-level-2">** for</span>
   <span class="org-verbatim">=for=</span> clause will not run at all if no sequence is specified:
<span class="org-block-begin-line">   #+BEGIN_SRC scheme
</span><span class="org-block">     (with-input-from-string "appleppppl"
       (lambda ()
         (for (#:break (eof-object? (peek-char (current-input-port))))
           (printf "~a~n" (regexp-match #rx"p+(.)" (current-input-port))))))
</span><span class="org-block-end-line">   #+END_SRC
</span>   Instead, feed it with an infinite sequence:
<span class="org-block-begin-line">   #+BEGIN_SRC scheme
</span><span class="org-block">     (with-input-from-string "appleppppl"
       (lambda ()
         (for ([i (in-naturals 1)]
               #:break (eof-object? (peek-char (current-input-port))))
           (printf "~a~n" (regexp-match #rx"p+(.)" (current-input-port))))))
</span><span class="org-block-end-line">   #+END_SRC
</span>   
   Note that the position of <span class="org-verbatim">=#:when=</span>, <span class="org-verbatim">=#:unless=</span>, <span class="org-verbatim">=#:break=</span>,
   <span class="org-verbatim">=#:final=</span> matters. As the document says, if one of the above
   appears, racket will refactor the <span class="org-verbatim">=for=</span> clause with:
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (for (for-clauses-above ...)
       (when guard-expr
         (for (for-clause-remains ...) body ...+)))
</span><span class="org-block-end-line">   #+END_SRC
</span>   That would suprise you somehow, consider the following example(from
   the reference):
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (for ([i '(1 2 3)]
           [j "abc"]
           #:break (not (odd? i))
           [k '(1 2 3)])
       (display (list i j k)))
</span><span class="org-block-end-line">   #+end_src
</span>   it will produce <span class="org-verbatim">=(1 a 1)(1 a 2)(1 a 3)=</span> instead of <span class="org-verbatim">=(1 a 1)=</span>, if
   the latter is what you expected, check the following code:
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (for ([i '(1 2 3)]
           [j "abc"]
           [k '(1 2 3)]
           #:break (not (odd? i)))
       (display (list i j k)))
</span><span class="org-block-end-line">   #+end_src
</span>
<span class="org-level-1">* Topics</span>
<span class="org-level-2">** Memoized</span>
   Define function that uses a hash table to memorized computed arguemnts.
   
   First, define a macro for that:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (define-syntax define-memoized
       (syntax-rules ()
         [(define-memoized (f args ...) body ...)
          (define f
            (let ([ht (make-hash)])
              (lambda (args ...)
                (hash-ref! ht (list args ...) (thunk body ...)))))]))
</span><span class="org-block-end-line">   #+END_SRC
</span>   
   Note that the <span class="org-verbatim">=thunk=</span> in the above code. It is needed due to the
   behaviour of <span class="org-verbatim">=hash-ref!=</span> of racket, you can of course use the
   following instead:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (lambda (args ...)
       (define tmp (list args ...))
       (when (not (hash-has-key? ht tmp))
         (hash-set! ht tmp (begin body ...)))
       (hash-ref ht tmp))
</span><span class="org-block-end-line">   #+END_SRC
</span>   
   And then define functions using <span class="org-verbatim">=define-memoized=</span>:
<span class="org-block-begin-line">   #+BEGIN_SRC racket
</span><span class="org-block">     (define-memoized (mfibo n)
       (cond
         [(= n 0) 1]
         [(= n 1) 1]
         [else (+ (mfibo (- n 1)) (mfibo (- n 2)))]))
</span><span class="org-block-end-line">   #+END_SRC
</span>   
   Another way to implement this is using wrapper function plus
   assignment. Wrapper function is as follows:
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (define (memo fn)
       (let ([ht (make-hash)])
         (lambda args
           (hash-ref! ht args (thunk (apply fn args))))))
</span><span class="org-block-end-line">   #+end_src
</span>   And then we can use the wrapper function like:
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (define mfibo (memo fibo))
     (time (mfibo 30))  ; =&gt; Slow
     (time (mfibo 30))  ; =&gt; Fast
     (time (mfibo 31))  ; =&gt; Slow
</span><span class="org-block-end-line">   #+end_src
</span>   The reason that the final call being slow is that <span class="org-verbatim">=fn=</span> in <span class="org-verbatim">=memo=</span> is
   the un-memorized version, thus <span class="org-verbatim">=mfibo=</span> only memorize the arguments
   that is explicitly called by <span class="org-verbatim">=mfibo=</span> (that is 30 in the above
   example). In order to get the full memorized version, we can use
   the following:
<span class="org-block-begin-line">   #+begin_src scheme
</span><span class="org-block">     (set! fibo (memo fibo))
     (time (fibo 30))  ; =&gt; Fast
     (time (fibo 30))  ; =&gt; Fast
     (time (ibo 31))  ; =&gt; Fast
</span><span class="org-block-end-line">   #+end_src
</span>   Now <span class="org-verbatim">=fibo=</span> is full memorized!.
   
<span class="org-level-3">*** Reference</span>
    - <span class="org-link"><a href="http://codeimmersion.i3ci.hampshire.edu/2009/10/09/memoization/">[[http://codeimmersion.i3ci.hampshire.edu/2009/10/09/memoization/][</a><a href="http://codeimmersion.i3ci.hampshire.edu/2009/10/09/memoization/">Scheme Memoization</a><a href="http://codeimmersion.i3ci.hampshire.edu/2009/10/09/memoization/">]]</a></span>
   

</pre>
  </body>
</html>
