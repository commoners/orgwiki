<!DOCTYPE html>
<html>
<head>
<title>JavaScript Notes</title>
<!-- 2015-08-02 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Wang Menglei">
<link rel="Stylesheet" type="text/css" href="assets/css/style.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript">
    function show_org_source(){
       /* document.location.href = rpl(document.location.href,"html","org.html"); */
       var url = document.location.href.split('#')[0];
       document.location.href = url.replace(/.html$/, '.org.html');
    }
</script>
</head>
<body>
<div id="preamble" class="status">
<!--<body onload="prettyPrint()">-->
<nav>
    <a href="index.html">Index</a>
    <a href="about.html">About</a>
    <a href="https://lotabout.github.io">Blog</a>
    <a href="sitemap.html">SiteMap</a>
</nav>
</div>
<div id="content">
<h1 class="title">JavaScript Notes</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">JS Box metrics</a>
<ul>
<li><a href="#sec-1-1">CSS width/height</a></li>
<li><a href="#sec-1-2">clientWidth/Height</a></li>
<li><a href="#sec-1-3">scrollWidth/Height</a></li>
<li><a href="#sec-1-4">scrollTop/scrollLeft</a></li>
<li><a href="#sec-1-5">offsetWidth/Height</a></li>
<li><a href="#sec-1-6">clientTop/Left</a></li>
<li><a href="#sec-1-7">offsetParent, offsetLeft/Top</a></li>
<li><a href="#sec-1-8">Summary</a></li>
<li><a href="#sec-1-9">References</a></li>
</ul>
</li>
<li><a href="#sec-2">JS Position/Offset</a></li>
<li><a href="#sec-3">Event Position</a></li>
<li><a href="#sec-4">Prototype</a></li>
<li><a href="#sec-5">This</a>
<ul>
<li><a href="#sec-5-1">Global context</a></li>
<li><a href="#sec-5-2">Function context</a>
<ul>
<li><a href="#sec-5-2-1">Simple call</a></li>
<li><a href="#sec-5-2-2">As an object method</a></li>
<li><a href="#sec-5-2-3">As a constructor</a></li>
<li><a href="#sec-5-2-4">call and apply</a></li>
</ul>
</li>
<li><a href="#sec-5-3">As a DOM event handler</a></li>
<li><a href="#sec-5-4">As an in-line event handler</a></li>
<li><a href="#sec-5-5">Read More</a></li>
</ul>
</li>
<li><a href="#sec-6">Javascript and OOP</a>
<ul>
<li><a href="#sec-6-1">The inheritance chain</a></li>
<li><a href="#sec-6-2">The constructor hierarchy</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">JS Box metrics</h2>
<div class="outline-text-2" id="text-1">
<p>
<a id="sec:js-box-metrics" name="sec:js-box-metrics"></a>
</p>

<p>
There are several concepts of metrics used in javascript.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">CSS width/height</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Without <code>box-sizing: border-box</code> being set, it is the size of the
<span class="underline">content area</span>, which lies inside the padding. CSS properties can be
set using <code>element.style</code> property and retrieved using
<code>getComputedStyle()/currentStyle</code>.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">clientWidth/Height</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Size of the <code>client area</code>: content area with padding, but without scrollbars.
</p>

<pre class="example">
clientWidth = CSS-width + paddings - scrollbar-width;
clientHeight = CSS-height + paddings - scrollbar-height;
</pre>

<p>
NOTE: the scrollbars will first occupy the padding area, and if the
padding area is not large enough, it will further occupy the content
area, meanwhile the CSS width/height stays unchanged. Thus as in the
following image where <code>padding &gt; scrollbar-width</code>:
</p>


<div class="figure">
<p><img src="http://javascript.info/files/tutorial/browser/dom/metric2.png" alt="metric2.png">
</p>
</div>

<p>
The size can be calculated:
</p>
<pre class="example">
clientWidth = 300(width) + 40(paddings) - 16(scrollbar) = 324
clientHeight = 200(height) + 40(paddings) = 240
</pre>

<p>
However, if the <code>padding &lt; scrollbar-width</code>:
</p>


<div class="figure">
<p><img src="http://javascript.info/files/tutorial/browser/dom/metricClientWidth.png" alt="metricClientWidth.png">
</p>
</div>

<p>
The <span class="underline">CSS width</span> stays unchanged(300px), while the client width:
</p>

<pre class="example">
clientWidth = 300(width) + 0(paddings) - 16(scrollbar) = 284
</pre>

<p>
Thus the <code>clientWidth/clientHeight</code> reflect the real size of the content.
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">scrollWidth/Height</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Content area width and height <span class="underline">including</span> the scrolled out part. That
means they are the same as clientWidth/Height, but includes full
scrollable area.
</p>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">scrollTop/scrollLeft</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The size of scrolled out part: vertical and horizontal. The value is
always in pixels.
</p>

<p>
NOTE that you can set values to this property, the browser will scroll
the document accordingly.
</p>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">offsetWidth/Height</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Outer box width/height, full size with borders, but without margins.
</p>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">clientTop/Left</h3>
<div class="outline-text-3" id="text-1-6">
<p>
The indent of <span class="underline">client area</span> from box outer corner.
</p>


<div class="figure">
<p><img src="http://javascript.info/files/tutorial/browser/dom/metric3.png" alt="metric3.png">
</p>
</div>

<p>
Normally, the value is:
</p>
<pre class="example">
clientTop = border-top-width
clientLeft = border-left-width
</pre>

<p>
However, in case of a <span class="underline">right-to-left</span> document, where the scrollbar
appears on the top and left, the value is:
</p>
<pre class="example">
clientTop = border-top-width + scrollbar-width
clientLeft = border-left-width + scrollbar-width
</pre>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">offsetParent, offsetLeft/Top</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Properties <code>offsetLeft</code> and <code>offsetTop</code> reflects a relative shift of
an element from its <code>offsetParent</code>.
</p>

<p>
The <code>offsetParent</code> is the closest(nearest in the containment
hierarchy) <b>positioned</b> containing element. If the element is
non-positioned, but the ancestor is a table cell(<code>td</code>, <code>th</code> or
<code>table</code>) or root element (<code>html</code> in standards compliant mode; <code>body</code>
in quirks rendering mode) is the <code>offsetParent</code>. See
<a href="http://dev.w3.org/csswg/cssom-view/#dom-htmlelement-offsetparent">DOM
HTML Element &#x2013; offsetparent</a> for specification.
</p>


<div class="figure">
<p><img src="http://javascript.info/files/tutorial/browser/dom/metricOffset.png" alt="metricOffset.png">
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8">Summary</h3>
<div class="outline-text-3" id="text-1-8">
<ol class="org-ol">
<li>The <span class="underline">CSS width/height</span> is the width of the content area, and will
stick to the value it is.
</li>
<li>The <code>Client Area</code> is the content area plus padding, but do not include
the scrollbar.
</li>
<li>The <code>Offset Area</code> is the whole content of an element except the margin.
</li>
<li>All the width/height and left/top properties are calculated
according to what they are(client/offset area).
</li>
</ol>


<div class="figure">
<p><img src="http://javascript.info/files/tutorial/browser/dom/metricSummary.png" alt="metricSummary.png">
</p>
</div>
</div>
</div>



<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9">References</h3>
<div class="outline-text-3" id="text-1-9">
<p>
<a href="http://javascript.info/tutorial/metrics">JS metrics</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">JS Position/Offset</h2>
<div class="outline-text-2" id="text-2">
<p>
The <a href="#sec:js-box-metrics">previous section</a> introduced the box model
of javascript. However, there are still two important requirement we
have: get the position of current element.
</p>

<p>
Two concept will be involed here: document and viewport.
</p>

<p>
<a href="https://developer.mozilla.org/en/docs/Web/API/Document">Document</a>
serves as an entry point into the web page's content(The DOM
tree). You can treat it as the <code>&lt;html&gt;</code> object in HTML source
code. And JS provide a variable <code>document</code> for it.
</p>

<p>
<a href="https://developer.mozilla.org/en-US/docs/Glossary/Viewport">Viewport</a>
represents a polygonal(normally rectangular) area in computer graphics
currently being viewed. So we can treat it as the browser that
displays contents. 
</p>

<p>
I actually cannot distinguish viewport from
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window">window</a>,
it seems that viewport is an abstract concept that refer to any
view-able area, while window refers to the actual "physical" object.
</p>

<p>
Because the window size can scroll, so the position of an element
could be relative to either document or viewport.
</p>

<p>
As for those relative to the <b>viewport</b>, JS provide us a handy function:
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect">getBoundingClientRect()</a>
that will return the size of an element and its position relative to viewport.
</p>

<p>
As for those relative to the <b>document</b>, JS do not have direct answer,
however the JQuery function <a href="http://api.jquery.com/offset/">.offset</a>
is an alternate to that. Of course you can implement it in plain JS as
well, You can check the JQuery implementation
<a href="http://james.padolsey.com/jquery/#v=1.11.2&fn=jQuery.fn.offset">here</a>.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Event Position</h2>
<div class="outline-text-2" id="text-3">
<dl class="org-dl">
<dt> clientX/clientY </dt><dd>the coordinate of the mouse pointer relative
to the current window(viewport), when the event was triggered.
</dd>
<dt> screenX/screenY </dt><dd>the coordinate of the mouse pointer, relative to
the screen, when the event was triggered.
</dd>
<dt> pageX/pageY </dt><dd>the coordinate of the event relative to the whole
document. This is non-standard.
</dd>
<dt> layerX/layerY </dt><dd>the coordinate of the event relative to the current
layer. Non-standard.
</dd>
</dl>

<p>
<a href="http://web.jobbole.com/82419/">About JS event</a>
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Prototype</h2>
<div class="outline-text-2" id="text-4">
<p>
Modifying the prototype of a javascript class(i.e. a function) will
affect all instances using this object. It is like editing the class
itself in Java and all instances of this class will be affected.
</p>

<p>
<a href="http://www.w3schools.com/js/js_object_prototypes.asp">prototype</a> is
the only way of doing this.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">This</h2>
<div class="outline-text-2" id="text-5">
<p>
NOTE: this section is maily taken from <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">MDN</a>
</p>

<p>
Normally,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a>
is determined by how a function is called. It cannot be set by
assignment during execution.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Global context</h3>
<div class="outline-text-3" id="text-5-1">
<p>
In global execution contex(outside of any function) <code>this</code> refers to
the global object, whether in scrit mode or not.
</p>

<div class="org-src-container">

<pre class="src src-javascript">console.log(<span style="color: #bfebbf;">this</span>.document === document); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">true</span>

<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">In web browsers, the window object is also the global object:</span>
console.log(<span style="color: #bfebbf;">this</span> === window); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">true</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Function context</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Inside a function, the value of <code>this</code> depends on how the function is
called.
</p>
</div>

<div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">Simple call</h4>
<div class="outline-text-4" id="text-5-2-1">
<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">f1</span>(){
  <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>;
}

f1() === window; <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">global object</span>
</pre>
</div>

<p>
In this case, the value of <code>this</code> is not set by the call. Since the
code is not in <code>strict</code> mode, the value of <code>this</code> must always be an
object so it defaults to the global object.
</p>

<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">f2</span>(){
  <span style="color: #cc9393;">"use strict"</span>; <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">see strict mode</span>
  <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>;
}

f2() === <span style="color: #bfebbf;">undefined</span>;
</pre>
</div>

<p>
In <code>strict</code> mod,e the value of <code>this</code> remains at whatever it is set
when entering the execution context.
</p>
</div>
</div>

<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2">As an object method</h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
When a function is called as a method of an object, its <code>this</code> is set
to the object the method is called on.
</p>

<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">o</span> = {
    prop: 37,
    <span style="color: #8cd0d3;">f</span>: <span style="color: #f0dfaf; font-weight: bold;">function</span>() {
        <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>.prop;
    }
};

console.log(o.f()); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">logs 37</span>
</pre>
</div>

<p>
This behavior is not at all affected by how or where the function was defined.
</p>

<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">o</span> = {prop: 37};

<span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">independent</span>() {
  <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>.prop;
}

o.f = independent;

console.log(o.f()); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">logs 37</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2-3" class="outline-4">
<h4 id="sec-5-2-3">As a constructor</h4>
<div class="outline-text-4" id="text-5-2-3">
<p>
when a function is used as a constructor(with the <code>new</code> keyword), its
<code>this</code> is bound to the new object being constructed.
</p>
</div>
</div>

<div id="outline-container-sec-5-2-4" class="outline-4">
<h4 id="sec-5-2-4">call and apply</h4>
<div class="outline-text-4" id="text-5-2-4">
<p>
By utilizing <code>call</code> and <code>apply</code>, we are able to specify <code>this</code> in a
function to anything we want:
</p>
<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">add</span>(<span style="color: #dfaf8f;">c</span>, <span style="color: #dfaf8f;">d</span>){
  <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>.a + <span style="color: #bfebbf;">this</span>.b + c + d;
}

<span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">o</span> = {a:1, b:3};

<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">The first parameter is the object to use as</span>
<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">'this', subsequent parameters are passed as </span>
<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">arguments in the function call</span>
add.call(o, 5, 7); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">1 + 3 + 5 + 7 = 16</span>

<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">The first parameter is the object to use as</span>
<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">'this', the second is an array whose</span>
<span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">members are used as the arguments in the function call</span>
add.apply(o, [10, 20]); <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">1 + 3 + 10 + 20 = 34</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">As a DOM event handler</h3>
<div class="outline-text-3" id="text-5-3">
<p>
When a function is used as an event handler, its <code>this</code> is set to the
element the event fired from.
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">As an in-line event handler</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Its <code>this</code> is set to the DOM element on which the listener is placed.
</p>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5">Read More</h3>
<div class="outline-text-3" id="text-5-5">
<ul class="org-ul">
<li><a href="http://web.jobbole.com/54267/">解密 JavaScript 中的 this</a>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Javascript and OOP</h2>
<div class="outline-text-2" id="text-6">
<p>
Actually ECMAScript 2015(ES6) introduced some new keywords to support
OOP in javascript. But we can actually simulate the OOP in older
versions. Here are something to note when implement it.
</p>

<p>
<b>Two things</b> we need to care about are:
</p>
<ol class="org-ol">
<li>How to inherit properties and methods from the super class?
</li>
<li>How to properly set the initial values of inherited properties?
</li>
</ol>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">The inheritance chain</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The first is called to
<a href="http://stackoverflow.com/questions/4152931/javascript-inheritance-call-super-constructor-or-use-prototype-chain">construct
a prototype chain</a>. Which is a function like this:
</p>

<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">extend</span>(<span style="color: #dfaf8f;">base</span>, <span style="color: #dfaf8f;">sub</span>) {
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">Avoid instantiating the base class just to setup inheritance</span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create</span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">for a polyfill</span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">Also, do a recursive merge of two prototypes, so we don't overwrite </span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">the existing prototype, but still maintain the inheritance chain</span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">Thanks to @ccnokes</span>
  <span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">origProto</span> = sub.<span style="color: #bfebbf;">prototype</span>;
  sub.<span style="color: #bfebbf;">prototype</span> = Object.create(base.<span style="color: #bfebbf;">prototype</span>);
  <span style="color: #f0dfaf; font-weight: bold;">for</span> (<span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">key</span> <span style="color: #f0dfaf; font-weight: bold;">in</span> origProto)  {
     sub.<span style="color: #bfebbf;">prototype</span>[key] = origProto[key];
  }
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">Remember the constructor property was set wrong, let's fix it</span>
  sub.<span style="color: #bfebbf;">prototype</span>.constructor = sub;
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">In ECMAScript5+ (all modern browsers), you can make the constructor property</span>
  <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">non-enumerable if you define it like this instead</span>
  Object.defineProperty(sub.<span style="color: #bfebbf;">prototype</span>, <span style="color: #cc9393;">'constructor'</span>, { 
    enumerable: <span style="color: #bfebbf;">false</span>, 
    value: sub 
  });
}
</pre>
</div>

<p>
With the help of the lookup strategy of Javascript's prototype, now
we inherited parent's properties and methods(called prototype).
</p>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">The constructor hierarchy</h3>
<div class="outline-text-3" id="text-6-2">
<p>
In traditional OOP language like java, we will initialize the
properties in its constructor, and when it is inherited by a
subclass, we should call its constructor in the subclass to get the
things right.
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #f0dfaf; font-weight: bold;">public</span> <span style="color: #f0dfaf; font-weight: bold;">class</span> <span style="color: #8cd0d3;">Shape</span> {
    <span style="color: #f0dfaf; font-weight: bold;">private</span> <span style="color: #8cd0d3;">String</span> <span style="color: #dfaf8f;">shape</span>;

    <span style="color: #8cd0d3;">Shape</span>(<span style="color: #8cd0d3;">String</span> <span style="color: #dfaf8f;">shape</span>) {
        <span style="color: #f0dfaf; font-weight: bold;">this</span>.shape = shape;
    }

    <span style="color: #8cd0d3;">String</span> <span style="color: #8cd0d3;">getShape</span>() {
        <span style="color: #f0dfaf; font-weight: bold;">return</span> shape;
    }
}
<span style="color: #f0dfaf; font-weight: bold;">public</span> <span style="color: #f0dfaf; font-weight: bold;">class</span> <span style="color: #8cd0d3;">Rect</span> <span style="color: #f0dfaf; font-weight: bold;">extends</span> <span style="color: #8cd0d3;">Shape</span> {
    <span style="color: #f0dfaf; font-weight: bold;">private</span> <span style="color: #8cd0d3;">int</span> <span style="color: #dfaf8f;">width</span>;
    <span style="color: #f0dfaf; font-weight: bold;">private</span> <span style="color: #8cd0d3;">int</span> <span style="color: #dfaf8f;">height</span>;
    <span style="color: #8cd0d3;">Rect</span>() {
        <span style="color: #f0dfaf; font-weight: bold;">super</span>(<span style="color: #cc9393;">"rect"</span>);
        width = 0;
        height = 0;
    }

    <span style="color: #f0dfaf; font-weight: bold;">public</span> <span style="color: #f0dfaf; font-weight: bold;">static</span> <span style="color: #8cd0d3;">void</span> <span style="color: #8cd0d3;">main</span>(<span style="color: #8cd0d3;">String</span>[] <span style="color: #dfaf8f;">args</span>) {
        <span style="color: #8cd0d3;">Rect</span> <span style="color: #dfaf8f;">rect</span> = <span style="color: #f0dfaf; font-weight: bold;">new</span> <span style="color: #8cd0d3;">Rect</span>();
        System.out.println(rect.getShape());
    }
}
</pre>
</div>

<p>
Note the call to <code>super</code> which in this case refer to constructor <code>Shape(String)</code>.
</p>

<p>
Although we've constructed the inheritance chain, the properties that
are set via the constructor can not be conveniently set in the sub
class. Here is a way to directly call the constructor of the super
class:
</p>

<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">Shape</span>(<span style="color: #dfaf8f;">shape</span>) {
    <span style="color: #bfebbf;">this</span>.shape = shape;
}

Shape.<span style="color: #bfebbf;">prototype</span>.getShape = <span style="color: #f0dfaf; font-weight: bold;">function</span> () {
    <span style="color: #f0dfaf; font-weight: bold;">return</span> <span style="color: #bfebbf;">this</span>.shape;
}

<span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">Rect</span>() {
    <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">should call the super class</span>
    Shape.call(<span style="color: #bfebbf;">this</span>, <span style="color: #cc9393;">"rect"</span>)
}

extend(Shape, Rect);

<span style="color: #f0dfaf; font-weight: bold;">var</span> <span style="color: #dfaf8f;">rect</span> = <span style="color: #f0dfaf; font-weight: bold;">new</span> <span style="color: #8cd0d3;">Rect</span>();
console.log(rect.getShape());
</pre>
</div>

<p>
The problem is with the <code>extend</code> utility, we actually haven't decide
which super class we are going to extend, that means we don't know
the name of <code>Shape</code> when we write <code>Rect()</code>. And under ECMAScript
2015, we don't have the <code>super</code> keyword to refer to the constructor.
</p>

<p>
So we need to save the super class's constructor. Below is the
modified version of <code>extend</code>:
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #8cd0d3;">function</span> <span style="color: #8cd0d3;">extend</span>(<span style="color: #8cd0d3;">base</span>, <span style="color: #8cd0d3;">sub</span>) {
    <span style="color: #8cd0d3;">var</span> <span style="color: #dfaf8f;">origProto</span> = sub.prototype;
    sub.prototype = Object.create(base.prototype);
    <span style="color: #f0dfaf; font-weight: bold;">for</span> (<span style="color: #8cd0d3;">var</span> key <span style="color: #8cd0d3;">in</span> <span style="color: #dfaf8f;">origProto</span>)  {
        sub.prototype[key] = origProto[key];
    }

    <span style="color: #7f9f7f;">// </span><span style="color: #7f9f7f;">save the super class's constructor.</span>
    sub.prototype.superConstructor = base.prototype.constructor

    sub.prototype.constructor = sub;
    Object.defineProperty(sub.prototype, <span style="color: #cc9393;">'constructor'</span>, { 
        <span style="color: #bfebbf;">enumerable</span>: <span style="color: #bfebbf;">false</span>, 
        value: sub 
    });
}
</pre>
</div>

<p>
Now it's time to replace the call to <code>Shape</code>:
</p>
<div class="org-src-container">

<pre class="src src-javascript"><span style="color: #f0dfaf; font-weight: bold;">function</span> <span style="color: #8cd0d3;">Rect</span>() {
    <span style="color: #bfebbf;">this</span>.superConstructor.call(<span style="color: #bfebbf;">this</span>, <span style="color: #cc9393;">"rect"</span>)
}
</pre>
</div>

<p>
And we get the same result.
</p>

<p>
In this way, we get the basic OOP out of javascript, however, there
is no default call to super class's default constructor. So we should
manually call it every time. Please think about what you can do to
enhance it.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="#" class="back-to-top">Back to Top</a>

<!-- <hr class="comment"> -->
<!-- <div id="show_source"> -->
<!--   <input type="button" value="Show Org source" onClick='show_org_source()'> -->
<!-- </div> -->

</script>
<hr class="comment">
<section class="comment">
<!-- An element a visitor can click if they <3 comments! -->
<button class="btn show-comments">Load Disqus comments</button>
<div id="disqus_thread"></div>
 
<!-- The empty element required for Disqus to loads comments into -->
<!--<div id="disqus_thread"></div>-->
    <!--<script type="text/javascript">-->
        <!--/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */-->
        <!--var disqus_shortname = 'lotaboutvimwiki'; // required: replace example with your forum shortname-->

        <!--/* * * DON'T EDIT BELOW THIS LINE * * */-->
        <!--(function() {-->
            <!--var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;-->
            <!--dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';-->
            <!--(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);-->
        <!--})();-->
    <!--</script>-->
    <!--<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->
</section>

<footer>
    |采用<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">CC BY-NC-SA 3.0</a>授权|由<a href="http://orgmode.org">Org Mode</a>自动生成<input type="button" value="Show Org source" onClick='show_org_source()'>|部署在<a href="https://github.com/lotabout/orgwiki">Github Pages</a>|
</footer>

    <script src="assets/js/jquery-1.7.1.min.js"></script>
    <script>
$(document).ready(function(){
	var offset = 100;
	var duration = 110;

        $(window).resize(function () {
            var toc= $('#table-of-contents')
            if ($(window).width() <= 800) {
                toc.css('position', 'static')
	        return
            }
            });
        $(window).scroll(
            function () {
            console.log("scroll called.")
            var toc= $('#table-of-contents')
            if ($(window).width() <= 800) {
            toc.css('position', 'static')
            return
            }

            if ($(this).scrollTop() > duration) {
            toc.css('left', toc.position().left + 'px')
            toc.css('position', 'fixed')
            $('.back-to-top').fadeIn(duration);
            } else {
            toc.css('left', '0px')
            toc.css('top', '0px')
            toc.css('position', 'relative')
            $('.back-to-top').fadeOut(duration);
            }
            });
        $('.back-to-top').click(
            function(event) {
            event.preventDefault;
            $('html, body').animate({scrollTop: 0}, duration);
            return false;
            });

        $('.show-comments').on('click', function(){
                               var disqus_shortname = 'lotaboutorgwiki'; // Replace this value with *your* username.

                               // ajax request to load the disqus javascript
                               $.ajax({
type: "GET",
url: "http://" + disqus_shortname + ".disqus.com/embed.js",
dataType: "script",
cache: true
});
                               // hide the button once comments load
                               $(this).fadeOut();
                               });
});
    </script>
</div>
</body>
</html>
